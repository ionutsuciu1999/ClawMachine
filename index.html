<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<title>Slot Machine Ionut Suciu</title>

<script>
var soldi = 3;
var posizione = 0; 
var i;
var puoimuovere = true;
var vittoria = false;
var randomcube = 100;

function aggiungisoldi(){
if(soldi >=0 && soldi <=99){
soldi = soldi + 1;
document.getElementById("soldi").innerHTML = soldi;
	}
}
function rimuovisoldi(){
if(soldi >0){
soldi = soldi - 1;
document.getElementById("soldi").innerHTML = soldi;
	}
}


function setposizione(pos){	//cambia posizione asse x del braccio
if(pos >= -534 && pos <= -287){
console.log("posizione x: "+pos);
document.getElementById("claw").style.marginLeft = pos + "px";
}
}

function setposizionesopra(pos){  //cambia posizione asse y del braccio
console.log("posizione y: "+pos);
document.getElementById("claw").style.marginTop = pos + "px";
}

function setposizionesopracubo(pos){  //cambia posizione asse y del cubo
console.log("posizione y: "+pos);
document.getElementById("cube").style.marginTop = pos + "px";
}

function spostadestra(){  //come spostasinistra
var x = document.getElementById("claw").style.marginLeft;
x = x.slice(0, -2);
console.log(x);
var i = 0;
if (puoimuovere == true){
function ciclo() { 
 console.log("entro nel ciclo");       
  setTimeout(function() {   
    x = Number(x)+1;
	console.log("x - i = "+x);
	setposizione(x);   
    i = i+1; 
	console.log("i = "+i);	
    if (i <= 30) {
	 console.log("i<30");
	  puoimuovere = false;
      ciclo();             
    } else {
	console.log("i>30");
	console.log("FINITO");
	  puoimuovere = true;
	}                      
  }, 20)
}
ciclo();  
}
}


function spostasinistra(){ //sposto il braccio a sinistra modificando il "marginLeft"
						   //funzione ricorsiva sposta di 1 pix per 30 volte
						   //puoimuovere diventa false e disabilita i bottoni, usato nel programma anche un altra tecnica,
						   //"document...onclick = fainulla" cambio la funzione onclick e la rimetto come era prima per disabilitare i bottoni
var x = document.getElementById("claw").style.marginLeft;
x = x.slice(0, -2);
console.log(x);
var i = 0;
if (puoimuovere == true){
function ciclo() { 
 console.log("entro nel ciclo");       
  setTimeout(function() {   
    x = x-1;
	console.log("x - i = "+x);
	setposizione(x);   
    i = i+1; 
	console.log("i = "+i);	
    if (i <= 30) {
	 console.log("i<30");
	  puoimuovere = false;
      ciclo();             
    } else {
	console.log("i>30");
	console.log("FINITO");
	  puoimuovere = true;
	}                      
  }, 20)
}
ciclo();  
}
}

function noncadi(){ //il cubo non cade
var i = 0;
function ciclo() {       
  setTimeout(function() {      
    i = i+1; 
	if(i==50){
	document.getElementById("claw").src = "immagini/clawclosed.png";
	}
    if (i <= 60) {
	  puoimuovere = false;
      ciclo();             
    } else {
	  puoimuovere = true;
	  document.getElementById("go").onclick = gioca; //ripristino il funzionamento dei bottoni quando finisce l'animazione
	}                      
  }, 9)
}
ciclo();  
}


function faicadere(){  //il braccio si sposta tutto a sinistra
var x = document.getElementById("claw").style.marginLeft;
x = x.slice(0, -2);
console.log(x);
var i = 0;
if (puoimuovere == true){
function ciclo() { 
 console.log("entro nel ciclo");       
  setTimeout(function() {   
    x = x-1;
	console.log("x - i = "+x);
	setposizione(x);   
    i = i+1; 
	console.log("i = "+i);	
    if (x >= -565) {
	 console.log("i<30");
	  puoimuovere = false;
      ciclo();             
    } else {
	console.log("i>30");
	console.log("FINITO");
	document.getElementById("claw").src = "immagini/clawopen.png"; //ripristino il funzionamento dei bottoni
	document.getElementById("go").onclick = gioca;
	document.getElementById("left").onclick = spostasinistra;
	document.getElementById("right").onclick = spostadestra;
	  puoimuovere = true;
	  if(vittoria == true){
	  cadi();
	  } else {
	  noncadi();
	  }
	}                      
  }, 20)
}
ciclo();  
}
}


function gioca(){
if((document.getElementById("soldi").innerHTML)>0){

var chancerandom = Math.floor(Math.random() * 20); //sceglie se vinci o no, genera 20 numeri, se tra 0 e 4 vittoria, a seconda del numero un cubo diverso
console.log("ChanceRandom = "+chancerandom);
if(chancerandom >=0 && chancerandom <=4){
vittoria = true;
} else {
vittoria = false;
}
console.log("vittoria = "+vittoria);
if (puoimuovere == true){
document.getElementById("go").onclick = fainulla; //disabilita i bottoni cosi da non poter interrompere l'animazione
document.getElementById("left").onclick = fainulla;
document.getElementById("right").onclick = fainulla;
document.getElementById("claw").src = "immagini/clawopen.png";
var random = Math.floor(Math.random() * 100);

var y = document.getElementById("claw").style.marginTop;
y = y.slice(0, -2); //ritorna "10px" quindi rimuovo i "px"
console.log(y);
var i = 0;
rimuovisoldi();
function scendi() {  //il braccio scende
 console.log("entro nel ciclo");       
  setTimeout(function() {   
    y = Number(y)+1;
	console.log("y - i = "+y);
	setposizionesopra(y);   
    i = i+1; 
	console.log("i = "+i);	
    if (i <= 110) {
	 console.log("i<30");
	  puoimuovere = false;
      scendi();             
    } else {
	console.log("i>30");
	console.log("SCESO");
	  sali();
	}                      
  }, 20)
}
scendi();  
}
	}
}

function sali(){ // il braccio sale
if(vittoria == true){
randomcube = Math.floor(Math.random() * 4);
document.getElementById("claw").src = "immagini/cube"+randomcube+".png";
document.getElementById("cube").src = "immagini/cube"+randomcube+""+randomcube+".png";
} else {
randomcube = 100;
document.getElementById("claw").src = "immagini/clawclosed.png";
}
var y = document.getElementById("claw").style.marginTop;
y = y.slice(0, -2);
console.log(y);
var i = 0;
function scendi() { 
 console.log("entro nel ciclo");       
  setTimeout(function() {   
    y = y-1;
	console.log("y - i = "+y);
	setposizionesopra(y);   
    i = i+1; 
	console.log("i = "+i);	
    if (i <= 110) {
	 console.log("i<30");
	  puoimuovere = false;
      scendi();             
    } else {
	console.log("i>30");
	console.log("SALITO");
	 puoimuovere = true;
	 faicadere();
	}                      
  }, 20)
}
scendi();  
}

function cadi(){ //il cubo cade
var y = document.getElementById("cube").style.marginTop;
document.getElementById("cube").style.opacity = "1";
y = y.slice(0, -2);
var i = 0;
if (puoimuovere == true){
function ciclo() {       
  setTimeout(function() {   
    y = Number(y)+1;
	setposizionesopracubo(y);   
    i = i+1; 
	if(i==50){
	document.getElementById("claw").src = "immagini/clawclosed.png";
	}
    if (y <= 570) {
	 console.log("i<30");
	  puoimuovere = false;
      ciclo();             
    } else {
	console.log("i>30");
	console.log("FINITO");
	  puoimuovere = true;
	  document.getElementById("cube").style.opacity = "0"; //il cubo Ã¨ invisibile e ha opacita 0, ma quando cade diventa 1 poi ridiventa 0
	  document.getElementById("cube").style.marginTop = "430px";
	}                      
  }, 9)
}
ciclo();  
}
}

function fainulla(){
console.log("bottone disabilitato");
}

</script>

</head>
<body width="100%" style="background-color:white">

<img style="width:650px" src='immagini/clawmachine.png'>
<img id = "polefront" style="width:377px; z-index:+5; position:absolute; margin-left: -547px; margin-top: +222px" src='immagini/polefront.png'>
<img id = "polefront" style="width:377px; z-index:+10; position:absolute; margin-left: -547px; margin-top: +222px" src='immagini/frontcubehide.png'>
<img id = "poleback" style="width:40px; z-index:-5; position:absolute; margin-left: -436px; margin-top: +224px" src='immagini/poleback.png'>
<img id = "window" style="width:556px; z-index:+15; position:absolute; margin-left: -592px; margin-top: +10px" src='immagini/clawtop.png'>
<img id = "window" style="width:519px; opacity:20%; z-index:+10; position:absolute; margin-left: -588px; margin-top: +132px" src='immagini/window.png'>
<img id = "left" onmouseover="this.src='immagini/leftpressed.png';" onmouseout="this.src='immagini/leftunpressed.png';" onclick="spostasinistra();" style="width:82px; z-index:+10; position:absolute; margin-left: -568px; margin-top: +625px" src='immagini/leftunpressed.png'>
<img id = "right" onmouseover="this.src='immagini/rightpressed.png';" onmouseout="this.src='immagini/rightunpressed.png';" onclick="spostadestra();" style="width:82px; z-index:+10; position:absolute; margin-left: -494px; margin-top: +625px" src='immagini/rightunpressed.png'>
<img id = "go" onmouseover="this.src='immagini/gopressed.png';" onmouseout="this.src='immagini/gounpressed.png';" onclick="gioca();" style="width:82px; z-index:+10; position:absolute; margin-left: -330px; margin-top: +625px" src='immagini/gounpressed.png'>
<img onmouseover="this.src='immagini/moneyinsert.png';" onmouseout="this.src='immagini/money.png';" onclick="aggiungisoldi();" style="width:52px; z-index:+10; position:absolute; margin-left: -320px; margin-top: +710px" src='immagini/money.png'>
<img style="width:456px; z-index:+1; position:absolute; margin-left: -541px; margin-top: +478px" src='immagini/back.png'>
<img id = "cube" style="opacity:0; width:56px; z-index:+5; position:absolute; margin-left: -499px; margin-top: +430px" src='immagini/cube11.png'>
<img id = "claw" style="width:122px; z-index:+3; position:absolute; margin-left: -380px; margin-top: +110px" src='immagini/clawclosed.png'>
<p id = "soldi" style="font-size:150%; color:white; z-index:+10; position:absolute; margin-left: +266px; margin-top: -223px">3</p>
<p>Javascript Claw Machine</p>
</body>
</html>